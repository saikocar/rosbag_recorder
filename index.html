<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ROS2 Memo Publisher</title>
  <script src="https://cdn.jsdelivr.net/npm/roslib/build/roslib.min.js"></script>
</head>
<body>
  <h1>Send Memo to ROS2</h1>
  <input type="text" id="memoInput" placeholder="Type your memo">
  <button onclick="sendMemo()">Send with message</button>
  <label><input type="checkbox" id="MassageSwitch"> 連打防止alert用スイッチ(チェック時に表示する)</label>
  </br>
  <button onclick="sendMemo_fixed('obstacle avoidance error')">obstacle avoidance error</button>
  <button onclick="sendMemo_fixed('obstacle detection error')">obstacle detection error</button>
  <button onclick="sendMemo_fixed('obstacle perception error')">obstacle perception error</button>
  <button onclick="sendMemo_fixed('irregular brake')">irregular brake</button>
  <button onclick="sendMemo_fixed('run out')">run out</button>
  <button onclick="sendMemo_fixed('bad intersection')">bad intersection</button>
  <button onclick="sendMemo_fixed('mrm')">mrm</button>
  </br>
  </br>
  <button onclick="sendMemo_fixed('誤検知')">誤検知</button>
  <button onclick="sendMemo_fixed('見落とし')">見落とし</button>
  <button onclick="sendMemo_fixed('不必要な停車')">不必要な停車</button>
  <button onclick="sendMemo_fixed('停車失敗')">停車失敗</button>
  <button onclick="sendMemo_fixed('車両の方向誤り')">車両の方向誤り</button>

  <script>
    // サーバーのIPアドレスを自動取得
    const SERVER_IP = window.location.hostname; // HTTPサーバーにアクセスしたIP
    const ROSBRIDGE_PORT = 9090;

    // Connect to rosbridge WebSocket server on the server's IP
    const ros = new ROSLIB.Ros({
      url: 'ws://' + SERVER_IP + ':' + ROSBRIDGE_PORT
    });

    ros.on('connection', function() {
      console.log('Connected to rosbridge WebSocket server at ' + SERVER_IP + ':' + ROSBRIDGE_PORT);
    });

    ros.on('error', function(error) {
      console.error('Error connecting to rosbridge:', error);
    });

    ros.on('close', function() {
      console.log('Connection to rosbridge closed.');
    });

    // Create a topic object
    const memoTopic = new ROSLIB.Topic({
      ros: ros,
      name: '/record_memo_text',
      messageType: 'std_msgs/String'
    });

    // Publish the memo
    function sendMemo() {
      const text = document.getElementById("memoInput").value;
      const message = new ROSLIB.Message({
        data: text
      });
      memoTopic.publish(message);
      console.log('Published message:', text);
      if(document.getElementById('MassageSwitch').checked){alert("Published message:" + text);}
    }

    function sendMemo_fixed(message_fixed) {
      const text = message_fixed;
      const message = new ROSLIB.Message({
        data: text
      });
      memoTopic.publish(message);
      console.log('Published message:', text);
      if(document.getElementById('MassageSwitch').checked){alert("Published message:" + text);}
    }
  </script>
</body>
</html>
